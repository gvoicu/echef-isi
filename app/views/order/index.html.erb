<h1>Order</h1>

<table>
  <tr>
  	<th>Name</th>
    <th>Ingredients</th>
    <th>Grams</th>
    <th>Price</th>
    <th>Time</th>
    <th>Dish type</th>
    <th>Dish Status</th>
    <th></th>
    <th></th>
    <th></th>
  </tr>

<% @total = 0 %>
<% @on_check = 0 %>
<% @subtotal = 0 %>
<% @order_dishes.each do |dish| %>
<% mDish = Dish.find(dish.dish_id)%>
	<% @total += mDish.price %>
  <tr>
  	<td><%= mDish.name %></td>
    <td><%= mDish.ingredients %></td>
    <td><%= mDish.grams %></td>
    <td><%= mDish.price %></td>
    <td><%= dish.time %></td>
    <td><%= mDish.dish_type.name %></td>
    
    <% if dish.is_pending? %>
    	<% @to_send = 1 %>
    	<td><%= "pending" %></td>
    	<td><%= link_to 'Remove', 'order/remove/%s' % dish.id, method: :delete %></td>
    <% elsif dish.is_preparing? %>
    	<% @sent = 1 %>
    	<td class="check"><%= "preparing" %></td>
    <% elsif dish.is_ready? %>
    	<% @sent = 1 %>
    	<td class="check"><%= "ready" %></td>
    <% elsif dish.is_delivered? %>
    	<% @sent = 1 %>
    	<td class="check"><%= "deliverd" %></td>
    <% elsif dish.is_check? %>
    	<% @sent = 2 if @sent != 1%>
    	<td><%= "check" %></td>
    	<% @on_check += mDish.price %>
    <% elsif dish.is_payed? %>
    	<% @sent = 2 if @sent != 1 %>
    	<td><%= "payed" %></td>
    <% end %>
    
    <% if !dish.is_check? %>
    	<% @subtotal += mDish.price %>
    <% end %>
  </tr>
<% end %>
</table>
	
	<%= link_to 'Menu', 'menu', method: :get %>
	<% if !@sent.nil? && @to_send == 1%>
		<%= link_to 'Update Order', 'order/send', method: :post %>
	<% elsif @to_send == 1 %>
		<%= link_to 'Send Order', 'order/send', method: :post %>
	<% end %>
	
	<% if @waiter.any? %>
		<p>Waiter called.</p>
	<% elsif %>
		<p id="call-waiter"><%= link_to 'Call waiter', 'order/waiter', method: :post, :remote => true %></p>
	<% end %>
	
	<% if @order_dishes.any? && @subtotal == 0 %>
		<p>Check requested.</p>
	<% elsif @order_dishes.any? && @subtotal != 0 && @sent == 1%>
		<p id="request-check"><%= link_to 'Request check', 'order/check', method: :post, :remote => true %></p>
	<% end %>
	
<br />
	
	Subtotal: <span id="subtotal"><%= @subtotal %></span>
	<br/>
	On Check: <span id="on-check"><%= @on_check %></span>
	<br/>
	Total: <span id="total"><%= @total %></span>
	
<br />
